#!/usr/bin/env sh

# Robust pre-commit that doesn't rely on global npm/npx in Git Bash/WSL on Windows
set -e

# Move to repo root
REPO_ROOT="$(git rev-parse --show-toplevel 2>/dev/null || echo "$(dirname "$0")/..")"
cd "$REPO_ROOT"

# Prefer local eslint if available
if [ -x "./node_modules/.bin/eslint" ]; then
	./node_modules/.bin/eslint . --ext .js,.jsx,.ts,.tsx || exit 1
	exit 0
fi

# Fallback to Next.js built-in lint
if [ -x "./node_modules/.bin/next" ]; then
	./node_modules/.bin/next lint || exit 1
	exit 0
fi

# Last resort: try npx without installing
if command -v npx >/dev/null 2>&1; then
	npx --no-install eslint . --ext .js,.jsx,.ts,.tsx 2>/dev/null || \
	npx --no-install next lint 2>/dev/null || true
	exit 0
fi

echo "husky: Skipping lint (no local eslint/next and npm/npx not available in this shell)" 1>&2
exit 0
